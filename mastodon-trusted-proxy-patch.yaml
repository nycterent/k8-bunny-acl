# Patch for Mastodon values to add trusted proxy configuration
# Add this to your Mastodon Helm values.yaml file

mastodon:
  extraEnvVars:
    RAILS_LOG_LEVEL: "error"
    FETCH_REPLIES_ENABLED: "true"
    # Trusted proxy configuration for Bunny CDN
    TRUSTED_PROXY_IP: "127.0.0.1/32"  # Default Rails setting
    
  # Additional environment variables to configure trusted proxy IPs
  extraEnvFrom:
    # Reference the ConfigMap created by bunny-ip-updater
    - configMapRef:
        name: bunny-trusted-ips
        optional: false

  streaming:
    extraEnvVars:
      RAILS_LOG_LEVEL: "error"
      FETCH_REPLIES_ENABLED: "true"
      # Trusted proxy configuration for streaming service
      TRUSTED_PROXY_IP: "127.0.0.1/32"  # Default setting
      
    extraEnvFrom:
      # Reference the ConfigMap created by bunny-ip-updater
      - configMapRef:
          name: bunny-trusted-ips
          optional: false